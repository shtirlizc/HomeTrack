generator client {
  provider      = "prisma-client"
  output        = "../lib/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model District {
  id          String   @id @default(uuid())
  title       String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  House House[]
}

model Developer {
  id        String   @id @default(uuid())
  title     String
  link      String?
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  House House[]
}

model Messenger {
  id        String   @id @default(uuid())
  link      String
  label     String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  houseMessengers HouseMessenger[]
}

model HouseMessenger {
  id          String    @id @default(uuid())
  houseId     String
  messengerId String
  house       House     @relation(fields: [houseId], references: [id])
  messenger   Messenger @relation(fields: [messengerId], references: [id])
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@unique([houseId, messengerId])
}

model Phone {
  id        String   @id @default(uuid())
  phone     String
  label     String
  isDefault Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  housePhones HousePhone[]
}

model HousePhone {
  id        String   @id @default(uuid())
  houseId   String
  phoneId   String
  house     House    @relation(fields: [houseId], references: [id])
  phone     Phone    @relation(fields: [phoneId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([houseId, phoneId])
}

enum HouseType {
  LandPlot
  Developer
  Secondary
  Commercial
}

enum LandCategory {
  IZHS
  SNT
  DNT
  Agricultural
  Other
}

enum Finishing {
  CleanFinish
  PreCleanFinish
  RoughFinish
}

enum Heating {
  Gas
  Electricity
  Other
}

enum FloorCount {
  One
  Two
  Three
}

enum BedroomCount {
  One
  Two
  Three
  Four
  Five
}

enum BathroomCount {
  One
  Two
  More
}

enum FacingMaterial {
  BarkBeetlePlaster
  Brick
  Siding
  Other
}

enum WallMaterial {
  Wood
  Brick
  ExpandedClay
  AeratedConcrete
  Other
}

enum Insulation {
  FoamPlastic
  MineralWool
  Other
}

enum HouseStatus {
  BuiltHouse
  UnderConstruction
  LandPlot
}

enum SaleStatus {
  Available
  Reserved
  Sold
}

model House {
  id                     String          @id @default(uuid())
  name                   String
  description            Json?
  type                   HouseType
  price                  Float
  houseArea              Float
  plotArea               Float
  landCategory           LandCategory
  finishing              Finishing
  heating                Heating
  asphaltToHouse         Boolean         @default(false)
  closedComplex          Boolean         @default(false)
  floor                  FloorCount
  bedroom                BedroomCount
  separatedKitchenLiving Boolean         @default(false)
  bathroom               BathroomCount
  facingMaterial         FacingMaterial?
  wallMaterial           WallMaterial
  insulation             Insulation?
  hasMinimumDownPayment  Boolean         @default(true)
  houseStatus            HouseStatus
  saleStatus             SaleStatus

  latitude        Float
  longitude       Float
  cadastralNumber String?
  yandexDiskLink  String?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  district   District @relation(fields: [districtId], references: [id])
  districtId String

  developer   Developer @relation(fields: [developerId], references: [id])
  developerId String

  messengers HouseMessenger[]
  phones     HousePhone[]
}
